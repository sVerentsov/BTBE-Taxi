<context>
	<input pattern="$Text">
		<context id="get_order" modal="true">
			<output value="Это бот для заказа такси"/>
			<pattern name="House" value="$Number [(/ $Number | (а|б|в|г|д|е) | (к|корпус) $Number )]"/>
			<pattern name="Street" value="entity://streets"/>
			<pattern name="FromAddress" value="$FromStreet::Street [,] [дом] $House"/>
			<pattern name="ToAddress" value="$ToStreet::Street [,] [дом] $House"/>
			<sample> 
				<item value="Заказать машину к Усилова, дом 3"/>
			</sample>
			<input>
				<!--><pattern value="*(заказ*|такси|машин*)*[(от|к) $FromAddress]*[(к|до) $ToAddress]*[$Date]*[$Time]"/>
				<output value="От: $FromAddress, До: $ToAddress, Дата: $Date, $Time"/>
				<!--> 
				<pattern value=" * (от|к) * $FromStreet::Street [,] [(дом|д|д.)] $HouseOut::House"/>
				<var name="Options" value='get("options", $FromStreet)' scope='context'/>
				<var name="StreetFullFrom" value='get(0, $Options)' scope='user'/>				
				<context id="ambiguationFrom" if="len($Options) gt 1">
					<output value="Уточните улицу, от которой поедете:"/>
					<var name="Options0" value='javascript: $Options[0]' scope='context'/>
					<var name="Options1" value='javascript: $Options[1]' scope='context'/>
					<var name="Options2" value='javascript: $Options[2]' scope='context'/>
					<var name="Options3" value='javascript: $Options[3]' scope='context'/>
					<sample> 
						<item value="$Options0"/>
						<item value="$Options1"/>
						<item value="$Options2"/>
						<item value="$Options3"/>
					</sample>
					<input pattern="$Street">
						<var name="Options" value='get("options", $Street)' scope='context'/>
						<var name="StreetFullFrom" value='get(0, $Options)' scope='user'/>	
						<context id="order_formed"/>
					</input>
				</context>
				<context id="order_formed"/>
			</input>
			<!-->
			<input pattern="$Street">
			</input>
			<!-->
		</context>
		
		<context id='order_formed'>
			<output value='order formed: $StreetFullFrom, $HouseOut'/>
			<sample> 
				<item value="Сделать ещё заказ"/>
			</sample>
			<input pattern="$Text">
				<context id='get_order'/>
			</input>
		</context>
	</input>
</context>	